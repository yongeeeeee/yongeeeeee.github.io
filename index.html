<!DOCTYPE html><html lang="en"><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KakaoTalk Clipboard Share Example</title>
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script>
        // Initialize Kakao SDK with your JavaScript key
        Kakao.init('58a4b536ddc574504cbe7b19168b3839');
        console.log('Kakao SDK initialized:', Kakao.isInitialized()); // Check if initialized

        async function shareOnKakao(text, imageUrl) {
            console.log('Sharing on Kakao:', text, imageUrl);
            Kakao.Link.sendDefault({
                objectType: 'feed',
                content: {
                    title: 'Shared from Clipboard',
                    description: text,
                    imageUrl: imageUrl,
                    link: {
                        mobileWebUrl: imageUrl,
                        webUrl: imageUrl
                    }
                },
                buttons: [
                    {
                        title: 'View Image',
                        link: {
                            mobileWebUrl: imageUrl,
                            webUrl: imageUrl
                        }
                    }
                ]
            })
            .then(response => {
                console.log('Success:', response);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to share: ' + error.message);
            });
        }

        function handlePasteEvent(e) {
            const items = e.clipboardData.items;
            let imageUrl = '';
            let imageFound = false;

            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf("image") !== -1) {
                    const blob = items[i].getAsFile();
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        imageUrl = event.target.result;
                        document.getElementById('preview').src = imageUrl;
                        imageFound = true;
                        if (imageFound) {
                            document.getElementById('share-btn').disabled = false;
                        }
                    };
                    reader.readAsDataURL(blob);
                }
            }
        }

        document.addEventListener('paste', handlePasteEvent);

        function enableShareButton() {
            const text = document.getElementById('text-input').value;
            const imageUrl = document.getElementById('preview').src;
            document.getElementById('share-btn').disabled = !(text || imageUrl);
        }
    </script></head><body>
    <h1>KakaoTalk Clipboard Share Example</h1>
    <p>Paste an image from your clipboard and/or enter text:</p>
    <div>
        <p>Text:</p>
        <textarea id="text-input" oninput="enableShareButton()" style="width: 100%; height: 100px;"></textarea>
    </div>
    <div>
        <p>Image:</p>
        <img id="preview" src="" alt="Image preview" style="max-width: 100%; height: auto;"/>
    </div>
    <br/>
    <button id="share-btn" disabled>Share on KakaoTalk</button>
    <script>
        document.getElementById('share-btn').onclick = function() {
            const text = document.getElementById('text-input').value;
            const imageUrl = document.getElementById('preview').src;
            shareOnKakao(text, imageUrl);
        };
    </script></body></html>
