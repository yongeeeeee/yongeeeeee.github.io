<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KakaoTalk Clipboard Share Example</title>
    <script src="https://developers.kakao.com/sdk/js/kakao.min.js"></script>
    <script>
        // Initialize Kakao SDK with your JavaScript key
        Kakao.init('YOUR_JAVASCRIPT_KEY');
        console.log(Kakao.isInitialized()); // Check if initialized

        async function shareOnKakao(text, imageUrl) {
            Kakao.Link.sendDefault({
                objectType: 'feed',
                content: {
                    title: 'Shared from Clipboard',
                    description: text,
                    imageUrl: imageUrl,
                    link: {
                        mobileWebUrl: imageUrl,
                        webUrl: imageUrl
                    }
                },
                buttons: [
                    {
                        title: 'View Image',
                        link: {
                            mobileWebUrl: imageUrl,
                            webUrl: imageUrl
                        }
                    }
                ]
            });
        }

        function handlePasteEvent(e) {
            const items = e.clipboardData.items;
            let text = '';
            let imageUrl = '';
            let imageFound = false;

            for (let i = 0; i < items.length; i++) {
                if (items[i].type.indexOf("image") !== -1) {
                    const blob = items[i].getAsFile();
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        imageUrl = event.target.result;
                        document.getElementById('preview').src = imageUrl;
                        imageFound = true;
                        if (text || imageFound) {
                            document.getElementById('share-btn').disabled = false;
                        }
                    };
                    reader.readAsDataURL(blob);
                } else if (items[i].kind === 'string') {
                    items[i].getAsString(function(str) {
                        text = str;
                        document.getElementById('text-preview').innerText = text;
                        if (text || imageFound) {
                            document.getElementById('share-btn').disabled = false;
                        }
                    });
                }
            }
        }

        document.addEventListener('paste', handlePasteEvent);
    </script>
</head>
<body>
    <h1>KakaoTalk Clipboard Share Example</h1>
    <p>Paste text and/or an image from your clipboard here:</p>
    <div>
        <p>Text:</p>
        <p id="text-preview" style="border: 1px solid #ccc; padding: 10px;"></p>
    </div>
    <div>
        <p>Image:</p>
        <img id="preview" src="" alt="Image preview" style="max-width: 100%; height: auto;"/>
    </div>
    <br/>
    <button id="share-btn" disabled>Share on KakaoTalk</button>
    <script>
        document.getElementById('share-btn').onclick = function() {
            const text = document.getElementById('text-preview').innerText;
            const imageUrl = document.getElementById('preview').src;
            shareOnKakao(text, imageUrl);
        };
    </script>
</body>
</html>
